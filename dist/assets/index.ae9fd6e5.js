(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function e(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerpolicy&&(s.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?s.credentials="include":i.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=e(i);fetch(i.href,s)}})();const B="/assets/sample.71ac2120.mp4",C="/assets/sample.651ca75a.srt";var L={};Object.defineProperty(L,"__esModule",{value:!0});var N=function(){function l(){this.seperator=","}return l.prototype.correctFormat=function(t){var e=t.replace(".",","),r=null,i=null,s=null,o=null,m=e.split(","),v=m[0],q=m[1];o=this.fixed_str_digit(3,q);var y=v.split(":"),I=y[0],P=y[1],M=y[2];return r=this.fixed_str_digit(2,I,!1),i=this.fixed_str_digit(2,P,!1),s=this.fixed_str_digit(2,M,!1),r+":"+i+":"+s+","+o},l.prototype.fixed_str_digit=function(t,e,r){if(r===void 0&&(r=!0),e.length==t)return e;if(e.length>t)return e.slice(0,t);if(e.length<t)return r?e.padEnd(t,"0"):e.padStart(t,"0")},l.prototype.tryComma=function(t){t=t.replace(/\r/g,"");var e=/(\d+)\n(\d{1,2}:\d{2}:\d{2},\d{1,3}) --> (\d{1,2}:\d{2}:\d{2},\d{1,3})/g,r=t.split(e);return r.shift(),r},l.prototype.tryDot=function(t){t=t.replace(/\r/g,"");var e=/(\d+)\n(\d{1,2}:\d{2}:\d{2}\.\d{1,3}) --> (\d{1,2}:\d{2}:\d{2}\.\d{1,3})/g,r=t.split(e);return r.shift(),this.seperator=".",r},l.prototype.fromSrt=function(t){var e=t,r=this.tryComma(e);r.length==0&&(r=this.tryDot(e));for(var i=[],s=0;s<r.length;s+=4){var o={id:r[s].trim(),startTime:this.correctFormat(r[s+1].trim()),endTime:this.correctFormat(r[s+2].trim()),text:r[s+3].trim()};i.push(o)}return i},l.prototype.toSrt=function(t){for(var e="",r=0;r<t.length;r++){var i=t[r];e+=i.id+`\r
`,e+=i.startTime+" --> "+i.endTime+`\r
`,e+=i.text.replace(`
`,`\r
`)+`\r
\r
`}return e},l}(),D=L.default=N;const O=class x{constructor(t,e){this.low=t,this.high=e}clone(){return new x(this.low,this.high)}get max(){return this.clone()}less_than(t){return this.low<t.low||this.low==t.low&&this.high<t.high}equal_to(t){return this.low==t.low&&this.high==t.high}intersect(t){return!this.not_intersect(t)}not_intersect(t){return this.high<t.low||t.high<this.low}merge(t){return new x(this.low===void 0?t.low:Math.min(this.low,t.low),this.high===void 0?t.high:Math.max(this.high,t.high))}output(){return[this.low,this.high]}static comparable_max(t,e){return t.merge(e)}static comparable_less_than(t,e){return t<e}},h=0,n=1;class f{constructor(t=void 0,e=void 0,r=null,i=null,s=null,o=n){this.left=r,this.right=i,this.parent=s,this.color=o,this.item={key:t,value:e},t&&t instanceof Array&&t.length==2&&!Number.isNaN(t[0])&&!Number.isNaN(t[1])&&(this.item.key=new O(Math.min(t[0],t[1]),Math.max(t[0],t[1]))),this.max=this.item.key?this.item.key.max:void 0}isNil(){return this.item.key===void 0&&this.item.value===void 0&&this.left===null&&this.right===null&&this.color===n}less_than(t){if(this.item.value===this.item.key&&t.item.value===t.item.key)return this.item.key.less_than(t.item.key);{let e=this.item.value&&t.item.value&&this.item.value.less_than?this.item.value.less_than(t.item.value):this.item.value<t.item.value;return this.item.key.less_than(t.item.key)||this.item.key.equal_to(t.item.key)&&e}}equal_to(t){if(this.item.value===this.item.key&&t.item.value===t.item.key)return this.item.key.equal_to(t.item.key);{let e=this.item.value&&t.item.value&&this.item.value.equal_to?this.item.value.equal_to(t.item.value):this.item.value==t.item.value;return this.item.key.equal_to(t.item.key)&&e}}intersect(t){return this.item.key.intersect(t.item.key)}copy_data(t){this.item.key=t.item.key,this.item.value=t.item.value}update_max(){if(this.max=this.item.key?this.item.key.max:void 0,this.right&&this.right.max){const t=this.item.key.constructor.comparable_max;this.max=t(this.max,this.right.max)}if(this.left&&this.left.max){const t=this.item.key.constructor.comparable_max;this.max=t(this.max,this.left.max)}}not_intersect_left_subtree(t){const e=this.item.key.constructor.comparable_less_than;let r=this.left.max.high!==void 0?this.left.max.high:this.left.max;return e(r,t.item.key.low)}not_intersect_right_subtree(t){const e=this.item.key.constructor.comparable_less_than;let r=this.right.max.low!==void 0?this.right.max.low:this.right.item.key.low;return e(t.item.key.high,r)}}class k{constructor(){this.root=null,this.nil_node=new f}get size(){let t=0;return this.tree_walk(this.root,()=>t++),t}get keys(){let t=[];return this.tree_walk(this.root,e=>t.push(e.item.key.output?e.item.key.output():e.item.key)),t}get values(){let t=[];return this.tree_walk(this.root,e=>t.push(e.item.value)),t}get items(){let t=[];return this.tree_walk(this.root,e=>t.push({key:e.item.key.output?e.item.key.output():e.item.key,value:e.item.value})),t}isEmpty(){return this.root==null||this.root==this.nil_node}clear(){this.root=null}insert(t,e=t){if(t===void 0)return;let r=new f(t,e,this.nil_node,this.nil_node,null,h);return this.tree_insert(r),this.recalc_max(r),r}exist(t,e=t){let r=new f(t,e);return!!this.tree_search(this.root,r)}remove(t,e=t){let r=new f(t,e),i=this.tree_search(this.root,r);return i&&this.tree_delete(i),i}search(t,e=(r,i)=>r===i?i.output():r){let r=new f(t),i=[];return this.tree_search_interval(this.root,r,i),i.map(s=>e(s.item.value,s.item.key))}intersect_any(t){let e=new f(t);return this.tree_find_any_interval(this.root,e)}forEach(t){this.tree_walk(this.root,e=>t(e.item.key,e.item.value))}map(t){const e=new k;return this.tree_walk(this.root,r=>e.insert(r.item.key,t(r.item.value,r.item.key))),e}recalc_max(t){let e=t;for(;e.parent!=null;)e.parent.update_max(),e=e.parent}tree_insert(t){let e=this.root,r=null;if(this.root==null||this.root==this.nil_node)this.root=t;else{for(;e!=this.nil_node;)r=e,t.less_than(e)?e=e.left:e=e.right;t.parent=r,t.less_than(r)?r.left=t:r.right=t}this.insert_fixup(t)}insert_fixup(t){let e,r;for(e=t;e!=this.root&&e.parent.color==h;)e.parent==e.parent.parent.left?(r=e.parent.parent.right,r.color==h?(e.parent.color=n,r.color=n,e.parent.parent.color=h,e=e.parent.parent):(e==e.parent.right&&(e=e.parent,this.rotate_left(e)),e.parent.color=n,e.parent.parent.color=h,this.rotate_right(e.parent.parent))):(r=e.parent.parent.left,r.color==h?(e.parent.color=n,r.color=n,e.parent.parent.color=h,e=e.parent.parent):(e==e.parent.left&&(e=e.parent,this.rotate_right(e)),e.parent.color=n,e.parent.parent.color=h,this.rotate_left(e.parent.parent)));this.root.color=n}tree_delete(t){let e,r;t.left==this.nil_node||t.right==this.nil_node?e=t:e=this.tree_successor(t),e.left!=this.nil_node?r=e.left:r=e.right,r.parent=e.parent,e==this.root?this.root=r:(e==e.parent.left?e.parent.left=r:e.parent.right=r,e.parent.update_max()),this.recalc_max(r),e!=t&&(t.copy_data(e),t.update_max(),this.recalc_max(t)),e.color==n&&this.delete_fixup(r)}delete_fixup(t){let e=t,r;for(;e!=this.root&&e.parent!=null&&e.color==n;)e==e.parent.left?(r=e.parent.right,r.color==h&&(r.color=n,e.parent.color=h,this.rotate_left(e.parent),r=e.parent.right),r.left.color==n&&r.right.color==n?(r.color=h,e=e.parent):(r.right.color==n&&(r.color=h,r.left.color=n,this.rotate_right(r),r=e.parent.right),r.color=e.parent.color,e.parent.color=n,r.right.color=n,this.rotate_left(e.parent),e=this.root)):(r=e.parent.left,r.color==h&&(r.color=n,e.parent.color=h,this.rotate_right(e.parent),r=e.parent.left),r.left.color==n&&r.right.color==n?(r.color=h,e=e.parent):(r.left.color==n&&(r.color=h,r.right.color=n,this.rotate_left(r),r=e.parent.left),r.color=e.parent.color,e.parent.color=n,r.left.color=n,this.rotate_right(e.parent),e=this.root));e.color=n}tree_search(t,e){if(!(t==null||t==this.nil_node))return e.equal_to(t)?t:e.less_than(t)?this.tree_search(t.left,e):this.tree_search(t.right,e)}tree_search_interval(t,e,r){t!=null&&t!=this.nil_node&&(t.left!=this.nil_node&&!t.not_intersect_left_subtree(e)&&this.tree_search_interval(t.left,e,r),t.intersect(e)&&r.push(t),t.right!=this.nil_node&&!t.not_intersect_right_subtree(e)&&this.tree_search_interval(t.right,e,r))}tree_find_any_interval(t,e){let r=!1;return t!=null&&t!=this.nil_node&&(t.left!=this.nil_node&&!t.not_intersect_left_subtree(e)&&(r=this.tree_find_any_interval(t.left,e)),r||(r=t.intersect(e)),!r&&t.right!=this.nil_node&&!t.not_intersect_right_subtree(e)&&(r=this.tree_find_any_interval(t.right,e))),r}local_minimum(t){let e=t;for(;e.left!=null&&e.left!=this.nil_node;)e=e.left;return e}local_maximum(t){let e=t;for(;e.right!=null&&e.right!=this.nil_node;)e=e.right;return e}tree_successor(t){let e,r,i;if(t.right!=this.nil_node)e=this.local_minimum(t.right);else{for(r=t,i=t.parent;i!=null&&i.right==r;)r=i,i=i.parent;e=i}return e}rotate_left(t){let e=t.right;t.right=e.left,e.left!=this.nil_node&&(e.left.parent=t),e.parent=t.parent,t==this.root?this.root=e:t==t.parent.left?t.parent.left=e:t.parent.right=e,e.left=t,t.parent=e,t!=null&&t!=this.nil_node&&t.update_max(),e=t.parent,e!=null&&e!=this.nil_node&&e.update_max()}rotate_right(t){let e=t.left;t.left=e.right,e.right!=this.nil_node&&(e.right.parent=t),e.parent=t.parent,t==this.root?this.root=e:t==t.parent.left?t.parent.left=e:t.parent.right=e,e.right=t,t.parent=e,t!=null&&t!=this.nil_node&&t.update_max(),e=t.parent,e!=null&&e!=this.nil_node&&e.update_max()}tree_walk(t,e){t!=null&&t!=this.nil_node&&(this.tree_walk(t.left,e),e(t),this.tree_walk(t.right,e))}testRedBlackProperty(){let t=!0;return this.tree_walk(this.root,function(e){e.color==h&&(e.left.color==n&&e.right.color==n||(t=!1))}),t}testBlackHeightProperty(t){let e=0,r=0,i=0;if(t.color==n&&e++,t.left!=this.nil_node?r=this.testBlackHeightProperty(t.left):r=1,t.right!=this.nil_node?i=this.testBlackHeightProperty(t.right):i=1,r!=i)throw new Error("Red-black height property violated");return e+=r,e}}const b=new D,S=document.querySelector("input#input-video"),T=document.querySelector("input#input-subs"),d=document.querySelector("button#input-video"),_=document.querySelector("button#input-subs"),p=document.querySelector("canvas#player"),w=document.querySelector("button#play-pause"),g=document.querySelector("progress#seekbar"),c=document.createElement("video"),u=A(p);(async function(){const e=await(await fetch(C)).text();R(e)})();F(c,B);function A(l){const t=window.devicePixelRatio||1,e=l.getBoundingClientRect();l.width=e.width*t,l.height=e.height*t;const r=l.getContext("2d");return r.scale(t,t),r}const a={videoFile:null,srtFile:null,srtFileData:null,parsedSrt:[],srtTree:new k,isPlaying:!1,globalError:!1,alternator:!1};setInterval(()=>a.alternator=!a.alternator,3500);function H(l){const t=a.srtTree.search([l,l]);return t.length==0?null:t[0]}function V(l,t){const e=Math.min(t.width/l.videoWidth,t.height/l.videoHeight),r=t.width/2-l.videoWidth/2*e,i=t.height/2-l.videoHeight/2*e;return[r,i,l.videoWidth*e,l.videoHeight*e]}async function F(l,t){if(typeof t=="string")l.src=t;else{const e=URL.createObjectURL(t);l.src=e}c.addEventListener("play",()=>{const e=V(c,p);console.log(e);function r(){u.drawImage(c,e[0],e[1],e[2],e[3]),u.save();const i=H(c.currentTime);if(i){const s=u.measureText(i).width,o=10;u.fillStyle="rgba(0, 0, 0, 0.7)",u.fillRect(p.width/2-s/2-o/2,p.height*.85-24,s+o,parseInt(u.font,10)+o),u.save(),u.textAlign="center",u.fillStyle="#fff",u.font="normal 24px Arial",u.fillText(i,p.width/2,p.height*.85)}requestAnimationFrame(r)}requestAnimationFrame(r)}),c.addEventListener("timeupdate",()=>{const e=c.currentTime/c.duration*100;g.value=e}),g.addEventListener("click",e=>{const r=g.getBoundingClientRect(),i={top:r.top+window.scrollY,left:r.left+window.scrollX},s=e.pageX-i.left,o=g.clientWidth,m=s/o,v=c.duration*m;c.currentTime=v}),c.addEventListener("canplay",()=>{w.addEventListener("click",async()=>{a.isPlaying?(await c.pause(),w.innerHTML="Play"):(await c.play(),w.innerHTML="Pause")}),c.addEventListener("play",()=>{a.isPlaying=!0}),c.addEventListener("pause",()=>{a.isPlaying=!1})})}function W(l){return console.log("video selected",l),l||null}function U(l){return console.log("subs selected",l),l||null}function E(l){const t=l.split(":"),e=t[2].split(","),r=parseInt(t[0])*3600,i=parseInt(t[1])*60,s=parseInt(e[0]),o=parseInt(e[1])/1e3;return r+i+s+o}function j(l){for(const t of l)a.srtTree.insert([E(t==null?void 0:t.startTime),E(t==null?void 0:t.endTime)],t==null?void 0:t.text);return a.srtTree}function R(l){if(!b.correctFormat(l))throw new Error("Incorrect srt format");a.parsedSrt=b.fromSrt(l),a.srtTree=j(a.parsedSrt)}S.addEventListener("change",async l=>{var r;const t=l.target;if(t.files.length==0)return;const e=(r=t.files)==null?void 0:r.item(0);if(d.classList.toggle("progress"),a.videoFile=W(e),!a.videoFile)return alert("Invalid Video Input selected");try{}catch(i){console.error(i,"Error reading Video File"),alert("Error reading Video File");return}finally{d.classList.toggle("progress")}d.classList.toggle("success"),F(c,a.videoFile)});T.addEventListener("change",async l=>{var r;const t=l.target;if(t.files.length==0)return;const e=(r=t.files)==null?void 0:r.item(0);if(_.classList.toggle("progress"),a.srtFile=U(e),!a.srtFile)return alert("Invalid SRT Input selected");try{a.srtFileData=await a.srtFile.text(),R(a.srtFileData),console.log(a.parsedSrt,"parsed srt file")}catch(i){console.error(i,"Error reading SRT File"),alert("Error reading SRT File");return}finally{_.classList.toggle("progress")}_.classList.toggle("success")});d.addEventListener("click",()=>{S.click()});_.addEventListener("click",()=>{T.click()});
